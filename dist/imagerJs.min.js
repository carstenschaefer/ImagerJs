/*! ImagerJs - 1.0.8 */

!function(){"use strict";function a(a){return JSON.parse(JSON.stringify(a))}function b(a){for(var b=l(a);"ÿà"<=b[1].slice(0,2)&&b[1].slice(0,2)<="ÿï";)b=[b[0]].concat(b.slice(2));return b.join("")}function c(a){return i(">"+k("B",a.length),a)}function d(a){return i(">"+k("H",a.length),a)}function e(a){return i(">"+k("L",a.length),a)}function f(a,b,f){var g,h,j,l,m="",n="";if("Byte"==b)g=a.length,4>=g?n=c(a)+k("\x00",4-g):(n=i(">L",[f]),m=c(a));else if("Short"==b)g=a.length,2>=g?n=d(a)+k("\x00\x00",2-g):(n=i(">L",[f]),m=d(a));else if("Long"==b)g=a.length,1>=g?n=e(a):(n=i(">L",[f]),m=e(a));else if("Ascii"==b)h=a+"\x00",g=h.length,g>4?(n=i(">L",[f]),m=h):n=h+k("\x00",4-g);else if("Rational"==b){if("number"==typeof a[0])g=1,j=a[0],l=a[1],h=i(">L",[j])+i(">L",[l]);else{g=a.length,h="";for(var o=0;g>o;o++)j=a[o][0],l=a[o][1],h+=i(">L",[j])+i(">L",[l])}n=i(">L",[f]),m=h}else if("SRational"==b){if("number"==typeof a[0])g=1,j=a[0],l=a[1],h=i(">l",[j])+i(">l",[l]);else{g=a.length,h="";for(var o=0;g>o;o++)j=a[o][0],l=a[o][1],h+=i(">l",[j])+i(">l",[l])}n=i(">L",[f]),m=h}else"Undefined"==b&&(g=a.length,g>4?(n=i(">L",[f]),m=a):n=a+k("\x00",4-g));var p=i(">L",[g]);return[p,n,m]}function g(a,b,c){var d,e=8,g=Object.keys(a).length,h=i(">H",[g]);d=["0th","1st"].indexOf(b)>-1?2+12*g+4:2+12*g;var j,k="",l="";for(var j in a)if("string"==typeof j&&(j=parseInt(j)),!("0th"==b&&[34665,34853].indexOf(j)>-1||"Exif"==b&&40965==j||"1st"==b&&[513,514].indexOf(j)>-1)){var m=a[j],n=i(">H",[j]),o=s[b][j].type,p=i(">H",[r[o]]);"number"==typeof m&&(m=[m]);var q=e+d+c+l.length,t=f(m,o,q),u=t[0],v=t[1],w=t[2];k+=n+p+u+v,l+=w}return[h+k,l]}function h(a){var b,c;if("ÿØ"==a.slice(0,2))b=l(a),c=m(b),this.tiftag=c?c.slice(10):null;else if(["II","MM"].indexOf(a.slice(0,2))>-1)this.tiftag=a;else{if("Exif"!=a.slice(0,4))throw"Given file is neither JPEG nor TIFF.";this.tiftag=a.slice(6)}}function i(a,b){if(!(b instanceof Array))throw"'pack' error. Got invalid type argument.";if(a.length-1!=b.length)throw"'pack' error. "+(a.length-1)+" marks, "+b.length+" elements.";var c;if("<"==a[0])c=!0;else{if(">"!=a[0])throw"";c=!1}for(var d="",e=1,f=null,g=null,h=null;g=a[e];){if("b"==g.toLowerCase()){if(f=b[e-1],"b"==g&&0>f&&(f+=256),f>255||0>f)throw"'pack' error.";h=String.fromCharCode(f)}else if("H"==g){if(f=b[e-1],f>65535||0>f)throw"'pack' error.";h=String.fromCharCode(Math.floor(f%65536/256))+String.fromCharCode(f%256),c&&(h=h.split("").reverse().join(""))}else{if("l"!=g.toLowerCase())throw"'pack' error.";if(f=b[e-1],"l"==g&&0>f&&(f+=4294967296),f>4294967295||0>f)throw"'pack' error.";h=String.fromCharCode(Math.floor(f/16777216))+String.fromCharCode(Math.floor(f%16777216/65536))+String.fromCharCode(Math.floor(f%65536/256))+String.fromCharCode(f%256),c&&(h=h.split("").reverse().join(""))}d+=h,e+=1}return d}function j(a,b){if("string"!=typeof b)throw"'unpack' error. Got invalid type argument.";for(var c=0,d=1;d<a.length;d++)if("b"==a[d].toLowerCase())c+=1;else if("h"==a[d].toLowerCase())c+=2;else{if("l"!=a[d].toLowerCase())throw"'unpack' error. Got invalid mark.";c+=4}if(c!=b.length)throw"'unpack' error. Mismatch between symbol and string length. "+c+":"+b.length;var e;if("<"==a[0])e=!0;else{if(">"!=a[0])throw"'unpack' error.";e=!1}for(var f=[],g=0,h=1,i=null,j=null,k=null,l="";j=a[h];){if("b"==j.toLowerCase())k=1,l=b.slice(g,g+k),i=l.charCodeAt(0),"b"==j&&i>=128&&(i-=256);else if("H"==j)k=2,l=b.slice(g,g+k),e&&(l=l.split("").reverse().join("")),i=256*l.charCodeAt(0)+l.charCodeAt(1);else{if("l"!=j.toLowerCase())throw"'unpack' error. "+j;k=4,l=b.slice(g,g+k),e&&(l=l.split("").reverse().join("")),i=16777216*l.charCodeAt(0)+65536*l.charCodeAt(1)+256*l.charCodeAt(2)+l.charCodeAt(3),"l"==j&&i>=2147483648&&(i-=4294967296)}f.push(i),g+=k,h+=1}return f}function k(a,b){for(var c="",d=0;b>d;d++)c+=a;return c}function l(a){if("ÿØ"!=a.slice(0,2))throw"Given data isn't JPEG.";for(var b=2,c=["ÿØ"];;){if("ÿÚ"==a.slice(b,b+2)){c.push(a.slice(b));break}var d=j(">H",a.slice(b+2,b+4))[0],e=b+d+2;if(c.push(a.slice(b,e)),b=e,b>=a.length)throw"Wrong JPEG data."}return c}function m(a){for(var b,c=0;c<a.length;c++)if(b=a[c],"ÿá"==b.slice(0,2))return b;return null}function n(a,b){return"ÿà"==a[1].slice(0,2)&&"ÿá"==a[2].slice(0,2)?b?(a[2]=b,a=["ÿØ",b].concat(a.slice(2))):a=null==b?a.slice(0,2).concat(a.slice(3)):a.slice(0).concat(a.slice(2)):"ÿà"==a[1].slice(0,2)?b&&(a[1]=b):"ÿá"==a[1].slice(0,2)?b?a[1]=b:null==b&&(a=a.slice(0).concat(a.slice(2))):b&&(a=[a[0],b].concat(a.slice(1))),a.join("")}var o={};if(o.remove=function(a){var b=!1;if("ÿØ"==a.slice(0,2));else{if("data:image/jpeg;base64,"!=a.slice(0,23)&&"data:image/jpg;base64,"!=a.slice(0,22))throw"Given data is not jpeg.";a=q(a.split(",")[1]),b=!0}var c=l(a);if("ÿá"==c[1].slice(0,2))c=[c[0]].concat(c.slice(2));else{if("ÿá"!=c[2].slice(0,2))throw"Exif not found.";c=c.slice(0,2).concat(c.slice(3))}var d=c.join("");return b&&(d="data:image/jpeg;base64,"+p(d)),d},o.insert=function(a,b){var c=!1;if("Exif\x00\x00"!=a.slice(0,6))throw"Given data is not exif.";if("ÿØ"==b.slice(0,2));else{if("data:image/jpeg;base64,"!=b.slice(0,23)&&"data:image/jpg;base64,"!=b.slice(0,22))throw"Given data is not jpeg.";b=q(b.split(",")[1]),c=!0}var d="ÿá"+i(">H",[a.length+2])+a,e=l(b),f=n(e,d);return c&&(f="data:image/jpeg;base64,"+p(f)),f},o.load=function(a){var b;if("string"!=typeof a)throw"'load' got invalid type argument.";if("ÿØ"==a.slice(0,2))b=a;else if("data:image/jpeg;base64,"==a.slice(0,23))b=q(a.split(",")[1]);else{if("Exif"!=a.slice(0,4))throw"'load' got invalid file data.";b=a.slice(6)}var c={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},d=new h(b);if(null===d.tiftag)return c;d.endian_mark="II"==d.tiftag.slice(0,2)?"<":">";var e=j(d.endian_mark+"L",d.tiftag.slice(4,8))[0];c["0th"]=d.get_ifd(e,"0th");var f=c["0th"].first_ifd_pointer;if(delete c["0th"].first_ifd_pointer,34665 in c["0th"]&&(e=c["0th"][34665],c.Exif=d.get_ifd(e,"Exif")),34853 in c["0th"]&&(e=c["0th"][34853],c.GPS=d.get_ifd(e,"GPS")),40965 in c.Exif&&(e=c.Exif[40965],c.Interop=d.get_ifd(e,"Interop")),"\x00\x00\x00\x00"!=f&&(e=j(d.endian_mark+"L",f)[0],c["1st"]=d.get_ifd(e,"1st"),513 in c["1st"]&&514 in c["1st"])){var g=c["1st"][513]+c["1st"][514],i=d.tiftag.slice(c["1st"][513],g);c.thumbnail=i}return c},o.dump=function(c){var d,e,f,h,j,k=8,l=a(c),m="Exif\x00\x00MM\x00*\x00\x00\x00\b",n=!1,o=!1,p=!1,q=!1;d="0th"in l?l["0th"]:{},("Exif"in l&&Object.keys(l.Exif).length||"Interop"in l&&Object.keys(l.Interop).length)&&(d[34665]=1,n=!0,e=l.Exif,"Interop"in l&&Object.keys(l.Interop).length&&(e[40965]=1,p=!0,f=l.Interop)),"GPS"in l&&Object.keys(l.GPS).length&&(d[34853]=1,o=!0,h=l.GPS),"1st"in l&&"thumbnail"in l&&null!=l.thumbnail&&(q=!0,l["1st"][513]=1,l["1st"][514]=1,j=l["1st"]);var s,t,u,v,w,x=g(d,"0th",0),y=x[0].length+12*n+12*o+4+x[1].length,z="",A=0,B="",C=0,D="",E=0,F="";if(n&&(s=g(e,"Exif",y),A=s[0].length+12*p+s[1].length),o&&(t=g(h,"GPS",y+A),B=t.join(""),C=B.length),p){var G=y+A+C;u=g(f,"Interop",G),D=u.join(""),E=D.length}if(q){var G=y+A+C+E;if(v=g(j,"1st",G),w=b(l.thumbnail),w.length>64e3)throw"Given thumbnail is too large. max 64kB"}var H="",I="",J="",K="\x00\x00\x00\x00";if(n){var L=k+y,M=i(">L",[L]),N=34665,O=i(">H",[N]),P=i(">H",[r.Long]),Q=i(">L",[1]);H=O+P+Q+M}if(o){var L=k+y+A,M=i(">L",[L]),N=34853,O=i(">H",[N]),P=i(">H",[r.Long]),Q=i(">L",[1]);I=O+P+Q+M}if(p){var L=k+y+A+C,M=i(">L",[L]),N=40965,O=i(">H",[N]),P=i(">H",[r.Long]),Q=i(">L",[1]);J=O+P+Q+M}if(q){var L=k+y+A+C+E;K=i(">L",[L]);var R=L+v[0].length+24+4+v[1].length,S="\x00\x00\x00\x00"+i(">L",[R]),T="\x00\x00\x00\x00"+i(">L",[w.length]);F=v[0]+S+T+"\x00\x00\x00\x00"+v[1]+w}var U=x[0]+H+I+K+x[1];return n&&(z=s[0]+J+s[1]),m+U+z+B+D+F},h.prototype={get_ifd:function(a,b){var c,d={},e=j(this.endian_mark+"H",this.tiftag.slice(a,a+2))[0],f=a+2;c=["0th","1st"].indexOf(b)>-1?"Image":b;for(var g=0;e>g;g++){a=f+12*g;var h=j(this.endian_mark+"H",this.tiftag.slice(a,a+2))[0],i=j(this.endian_mark+"H",this.tiftag.slice(a+2,a+4))[0],k=j(this.endian_mark+"L",this.tiftag.slice(a+4,a+8))[0],l=this.tiftag.slice(a+8,a+12),m=[i,k,l];h in s[c]&&(d[h]=this.convert_value(m))}return"0th"==b&&(a=f+12*e,d.first_ifd_pointer=this.tiftag.slice(a,a+4)),d},convert_value:function(a){var b,c=null,d=a[0],e=a[1],f=a[2];if(1==d)e>4?(b=j(this.endian_mark+"L",f)[0],c=j(this.endian_mark+k("B",e),this.tiftag.slice(b,b+e))):c=j(this.endian_mark+k("B",e),f.slice(0,e));else if(2==d)e>4?(b=j(this.endian_mark+"L",f)[0],c=this.tiftag.slice(b,b+e-1)):c=f.slice(0,e-1);else if(3==d)e>2?(b=j(this.endian_mark+"L",f)[0],c=j(this.endian_mark+k("H",e),this.tiftag.slice(b,b+2*e))):c=j(this.endian_mark+k("H",e),f.slice(0,2*e));else if(4==d)e>1?(b=j(this.endian_mark+"L",f)[0],c=j(this.endian_mark+k("L",e),this.tiftag.slice(b,b+4*e))):c=j(this.endian_mark+k("L",e),f);else if(5==d)if(b=j(this.endian_mark+"L",f)[0],e>1){c=[];for(var g=0;e>g;g++)c.push([j(this.endian_mark+"L",this.tiftag.slice(b+8*g,b+4+8*g))[0],j(this.endian_mark+"L",this.tiftag.slice(b+4+8*g,b+8+8*g))[0]])}else c=[j(this.endian_mark+"L",this.tiftag.slice(b,b+4))[0],j(this.endian_mark+"L",this.tiftag.slice(b+4,b+8))[0]];else if(7==d)e>4?(b=j(this.endian_mark+"L",f)[0],c=this.tiftag.slice(b,b+e)):c=f.slice(0,e);else{if(10!=d)throw"Exif might be wrong. Got incorrect value type to decode. type:"+d;if(b=j(this.endian_mark+"L",f)[0],e>1){c=[];for(var g=0;e>g;g++)c.push([j(this.endian_mark+"l",this.tiftag.slice(b+8*g,b+4+8*g))[0],j(this.endian_mark+"l",this.tiftag.slice(b+4+8*g,b+8+8*g))[0]])}else c=[j(this.endian_mark+"l",this.tiftag.slice(b,b+4))[0],j(this.endian_mark+"l",this.tiftag.slice(b+4,b+8))[0]]}return c instanceof Array&&1==c.length?c[0]:c}},"undefined"==typeof p)var p=function(a){for(var b,c,d,e,f,g,h,i="",j=0,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+k.charAt(e)+k.charAt(f)+k.charAt(g)+k.charAt(h);return i};if("undefined"==typeof q)var q=function(a){var b,c,d,e,f,g,h,i="",j=0,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=k.indexOf(a.charAt(j++)),f=k.indexOf(a.charAt(j++)),g=k.indexOf(a.charAt(j++)),h=k.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i};var r={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},s={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};s["0th"]=s.Image,s["1st"]=s.Image,o.TAGS=s,o.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},o.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},o.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},o.InteropIFD={InteroperabilityIndex:1},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=o),exports.piexif=o):window.piexif=o}();var ImagerJs={plugins:{},util:{},translations:{}};!function(a,b){var c=null,d=a('<div class="modaljs-overlay hidden hidden-add-end noselect"></div>'),e=a('<div class="modaljs-wrapper hidden noselect"><div class="modaljs-wrapper2 modaljs-modals-container noselect"></div></div>');a(document).ready(function(){c=a("body"),c.append(d),c.append(e)});var f=function(){var b=this,c=a('<div class="modaljs hidden noselect"><header></header><div class="modaljs-template-container noselect"></div><footer></footer>');e.find(".modaljs-modals-container").append(c),e.find(".modaljs").scroll(function(){a(window).trigger("resize")}),this.$modal=c,this.classname="",this.cancelHandler=null,a(window).resize(function(){b.fixPosition()}),a("body").on("imagerResize",function(){b.fixPosition()})};f.prototype.setTitle=function(a){this.$modal.find("header").html(a)},f.prototype.setTemplate=function(b){this.$modal.find(".modaljs-template-container").append(a(b))},f.prototype.fixPosition=function(){if(!(e.find(".modaljs").length<1)){var b=e.find(".modaljs > header")[0].getBoundingClientRect().height,c=e.find(".modaljs > .modaljs-template-container")[0].getBoundingClientRect().height,d=e.find(".modaljs > footer")[0].getBoundingClientRect().height,f=b+c+d;a(window).height()<=f?e.addClass("fullheight"):e.removeClass("fullheight")}},f.prototype.addCancelButton=function(b,c){var d=this;d.cancelHandler=c;var e=a("<button></button>").text(b);e.on("click",function(){d.hide(),d.cancelHandler&&d.cancelHandler()}),d.$modal.find("footer").append(e),d._fixButtonsSize()},f.prototype.addClass=function(a){this.classname+=" "+a,this.$modal.addClass(a)},f.prototype.addActionButton=function(b,c){var d=this,e=a("<button></button>").addClass("modaljs-action-button").text(b);e.on("click",function(){var a=c();void 0===a&&a!==!1&&d.hide()}),d.$modal.find("footer").append(e),d._fixButtonsSize()},f.prototype._fixButtonsSize=function(){var a=this.$modal.find("footer button");a.css("width",100/a.length+"%")},f.prototype.show=function(){var b=this;d.addClass(this.classname),d.removeClass("hidden-add-end"),d.removeClass("hidden"),d.css("height",a("body").height()),d.on("click",function(){b.hide(),b.cancelHandler&&b.cancelHandler()}),e.removeClass("hidden"),this.$modal.removeClass("hidden");var f=c.width();this.overflowBefore=c.css("overflow"),c.css("overflow","hidden"),this.widthDiff=c.width()-f,this.paddingBefore=c.css("padding-right"),c.css("padding-right",this.widthDiff+"px")},f.prototype.hide=function(){d.removeClass(this.classname),d.addClass("hidden"),setTimeout(function(){d.addClass("hidden-add-end")},400),d.off("click"),e.addClass("hidden"),this.$modal.addClass("hidden"),c.css("overflow",this.overflowBefore),c.css("padding-right",this.paddingBefore)},f.prototype.remove=function(){this.$modal.remove(),this.cancelHandler=!1},b.Modal=f}(jQuery,window),function(a,b,c){var d=function(b){var c=this;b=b||{};var d={tooltipEnabled:!0,
tooltipCss:null};c.options=a.extend(d,b),c.$toolbar=a('<ul class="toolbar"></ul>').attr("contenteditable","false").addClass("noselect").addClass("toolbar-topLeft"),c.tooltips=[],c.buttonsGroups={}};d.prototype.getElement=function(){return this.$toolbar},d.prototype.addButton=function(a,b,c,d){var e=this.createButton(a,b,d);return this.$toolbar.append(e),this.createTooltip(e.find("a"),a,c,"bottom"),e},d.prototype.createButton=function(b,d,e){var f=this,g=a('<li data-sizeable="toolbar-button" data-cssrules="width,height"><a href="#" data-sizeable="toolbar-button" data-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+d+'"></i></a></li>').addClass(b);return c.bindClick(g.find("a"),"imager-button",function(){return e(f)}),g},d.prototype.addButtonToGroup=function(b,d,e,f,g){var h=null;this.buttonsGroups[f.name]||(h=a('<li class="btn-group" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width,height"><a href="#" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+d+'"></i></a><ul class="group-items-container hidden"></ul></li>'),this.buttonsGroups[f.name]=h,this.$toolbar.append(h),c.bindClick(h.children("a"),"drawer-toolbar-group-button",function(){h.find("ul.group-items-container").toggleClass("hidden")}),this.createTooltip(h.children("a"),f.name,f.tooltip,"bottom")),h=this.buttonsGroups[f.name];var i=this.createButton(b,d,function(a){h.find("ul.group-items-container").toggleClass("hidden"),g(a),h.attr("class",i.attr("class")).addClass("btn-group"),h.children("a").attr("class",i.children("a").attr("class")),h.children("a").html(i.children("a").html())});return h.find(".group-items-container").append(i),this.createTooltip(i.find("a"),b+" group-item",e,"right"),i},d.prototype.createTooltip=function(b,c,d,e){if(this.options.tooltipEnabled){var f=a("<span>").addClass("toolbar-tooltip tooltip-"+c).html(d);f.appendTo("body"),this.tooltips.push(f),this.options.tooltipCss&&f.css(this.options.tooltipCss),b.on("mouseenter",function(){if(!a(this).hasClass("disabled")){var c=b.offset(),d=b.innerHeight(),g=b.innerWidth();f.addClass("active");var h=0,i=0;switch(e){case"right":h=c.top+(b.height()-f.outerHeight())/2,i=c.left+g;break;default:h=c.top+d,i=c.left+g/2-f.innerWidth()/2}f.css({top:h+"px",left:i+"px"})}}),b.on("mouseout",function(){f.removeClass("active")})}},d.prototype.setActiveButton=function(a){this.$toolbar.find("li."+a).children("a").addClass("active")},d.prototype.clearActiveButton=function(){this.$toolbar.find("li").children("a").removeClass("active")},d.prototype.remove=function(){this.$toolbar&&(this.$toolbar.remove(),this.$toolbar=null),this.tooltips&&(this.tooltips.map(function(a){return a.remove(),a=null,null}),this.tooltips=null)},b.Toolbar=d}(jQuery,window,ImagerJs.util),function(a,b,c){var d=function(c,d){var e=this;e.defaultOptions={sizes:[{label:"Original",scale:1,quality:1,percentage:100},{label:"Large",scale:.5,quality:.5,percentage:50},{label:"Medium",scale:.2,quality:.2,percentage:20},{label:"Small",scale:.05,quality:.05,percentage:5}],allowCustomSetting:!0},d=d?d:{},e.options=a.extend(!0,e.defaultOptions,d),e.options.allowCustomSetting&&e.options.sizes.push({label:"Custom"}),e.imager=c,e.$qualitySelector=a('<div class="imager-quality-wrapper"><form><div class="imager-quality-container form-group"><label for="imager-quality">'+b.t("Quality")+'</label><select id="imager-quality" class="form-control"></select></div></form><form class="form-inline custom-quality hidden"><div class="form-group"><label for="imager-quality-custom" class="imager-quality-custom">'+b.t("Custom quality percent")+'</label><div class="input-group"><input id="imager-quality-custom" type="number" min="1" max="100"class="form-control imager-quality-custom" value="100"/><div class="input-group-addon">%</div><div class="size-in-kb"></div></div></div></form></div>').addClass("hidden"),e.$qualitySelector.find("input.imager-quality-custom").change(function(){var c=parseInt(a(this).val());e.imager.quality=c/100,e.imager.targetScale=c/100,e.imager.render();var d=e.imager.getDataSize()/1024,f=Math.round(d)+" "+b.t("KB");e.$qualitySelector.find(".size-in-kb").text(f)}),e.$qualitySelector.find("select").on("change",function(){var b=parseInt(a(this).val()),c=e.options.sizes[b];(null===c||void 0===c)&&(c=e.options.sizes[0]),"Custom"==c.label?(e.$qualitySelector.find("form.custom-quality").removeClass("hidden"),e.$qualitySelector.addClass("custom-quality-visible"),e.imager.$imageElement.addClass("custom-quality-visible")):(e.$qualitySelector.find("form.custom-quality").addClass("hidden"),e.$qualitySelector.removeClass("custom-quality-visible"),e.imager.$imageElement.removeClass("custom-quality-visible")),a("body").trigger("imagerResize"),e.imager.adjustEditContainer(),e.imager.quality=c.quality?c.quality:.5,e.imager.targetScale=c.scale?c.scale:.5,e.imager.render()})};d.prototype.getElement=function(){return this.$qualitySelector},d.prototype.update=function(){var c=this.$qualitySelector.find("option:selected").val();this.$qualitySelector.find("option").remove();for(var d=0;d<this.options.sizes.length;d++){var e=this.options.sizes[d],f=b.t(e.label);if(void 0!==e.percentage){this.imager.quality=e.quality,this.imager.targetScale=e.scale,this.imager.render();var g=this.imager.getDataSize()/1024;f+=" - "+Math.round(g)+" "+b.t("KB")+" ("+e.percentage+"%)"}var h=a('<option value="'+d+'">'+f+"</option>");this.$qualitySelector.find("select").append(h)}this.$qualitySelector.find("select").val(c?c:0),this.$qualitySelector.find("select").trigger("change")},d.prototype.val=function(){this.$qualitySelector.find("select").val.apply(this.$qualitySelector,arguments)},d.prototype.show=function(){this.$qualitySelector.removeClass("hidden")},d.prototype.hide=function(){this.$qualitySelector.addClass("hidden")},c.ImagerQualitySelector=d}(jQuery,ImagerJs.translations,window),function(a,b){b.set=function(c){c=c?c:{},b.translations=a.extend(!0,b.translations,c)},b.translations={"Incorrect file type":"Incorrect file type",Insert:"Insert",Cancel:"Cancel","Add image":"Add image",Quality:"Quality",Rotate:"Rotate",Crop:"Crop",Original:"Original",KB:"KB",Large:"Large",Medium:"Medium",Small:"Small","Custom quality percent":"Custom quality percent",Custom:"Custom","Image properties":"Image properties","Size:":"Size:","width in px":"width in px","height in px":"height in px",Left:"Left",Right:"Right",Center:"Center",Inline:"Inline",Floating:"Floating","Transparent background":"Transparent background",Apply:"Apply",Reject:"Reject","Delete image":"Delete image","Move image":"Move image","Are you sure want to delete this image?":"Are you sure want to delete this image?","Or drop files here":"Or drop files here","No file selected.":"No file selected.","Please wait...":"Please wait...",Save:"Save",Undo:"Undo","Rotate manually":"Rotate manually","Rotate 90 left":"Rotate 90° left","Rotate 90 right":"Rotate 90° left","Image is too big and could cause very poor performance.":"Image is too big and could cause very poor performance."},b.t=function(a){return b.translations[a]?b.translations[a]:(console.warn("String not found in texts:"+a),a)}}(jQuery,ImagerJs.translations),function(a,b,c,d,e){var f=[],g={ios:"ios",android:"android",windowsMobile:"windowsMobile",genericMobile:"genericMobile"},h=function(b,d){var e=this;e.$imageElement=a(b),e.defaultOptions={saveData:void 0,loadData:void 0,quality:1,targetScale:1,plugins:[],format:void 0,toolbarButtonSize:32,toolbarButtonSizeTouch:50,editModeCss:{border:"1px solid white"},pluginsConfig:{},detectTouch:null,waitingCursor:"wait",imageSizeForPerformanceWarning:1e6,maxImageWidth:2048,maxImageHeight:2048},d=d?d:{},e.options=a.extend(!0,e.defaultOptions,d),e.debug=!1,e.showTemporaryCanvas=!1,e.targetScale=e.options.targetScale,e.quality=e.options.quality,e._eventEmitter=a({}),e._isInEditMode=!1,e.history=[],f.push(e),e.originalExif=null,this.detectPlatform(),this.options.canvasSizeLimit||(this.canvasSizeLimit=-1!==[g.ios,g.android,g.windowsMobile].indexOf(e.platform)?5242880:33554432),e.$originalImage=e.$imageElement.clone(),e.handleImageElementSrcChanged(),e.pluginsInstances=null,e.instantiatePlugins(c),a("body").on("imagerResize",function(){e.adjustEditContainer()}),a(window).on("resize",function(){e.adjustEditContainer()})};h.prototype.on=function(a,b){this._eventEmitter.on(a,b)},h.prototype.off=function(a){this._eventEmitter.off(a)},h.prototype.trigger=function(a,b){this._eventEmitter.trigger(a,b);for(var c="on"+a.substr(0,1).toUpperCase()+a.substr(1),d=0;d<this.pluginsInstances.length;d++){var e=this.pluginsInstances[d];void 0!==e[c]&&e[c](b)}},h.prototype.log=function(){if(this.debug){var a=Array.prototype.slice.call(arguments);console.log.apply(console,a)}},h.prototype.invokePluginsMethod=function(a){var b=[],c=Array.prototype.slice.call(arguments);c=c.slice(1);for(var d=0;d<this.pluginsInstances.length;d++){var e=this.pluginsInstances[d];if(void 0!==e[a]){var f=e[a].apply(e,c);f&&b.push({name:e.__name,instance:e,result:f})}}return b},h.prototype.pluginSort=function(a,b){return(void 0===a.weight||null===b.weight)&&(a.weight=1/0),(void 0===b.weight||null===b.weight)&&(b.weight=1/0),a.weight<b.weight?-1:a.weight>b.weight?1:0},h.prototype.instantiatePlugins=function(a){this.pluginsInstances=[];for(var b in a)if(this.options.plugins.indexOf(b)>-1&&a.hasOwnProperty(b)){var c=new a[b](this,this.options.pluginsConfig[b]);c.__name=b,this.pluginsInstances.push(c)}this.pluginsInstances.sort(this.pluginSort)},h.prototype.getPluginInstance=function(a){for(var b=0;b<this.pluginsInstances.length;b++){var c=this.pluginsInstances[b];if(c.__name==a)return c}return void 0},h.prototype.handleImageElementSrcChanged=function(){var a=this;if(a.options.format||(a.options.format=a.getImageFormat(a.$imageElement.attr("src"))),a.$imageElement.attr("data-imager-id")){if(a.id=a.$imageElement.attr("data-imager-id"),a.$imageElement.attr("src").length<1)throw new Error("Imager was initialized on an empty image. Please check image's `src` attribute. It should not be empty.")}else a.id=d.uuid(),a.$imageElement.attr("data-imager-id",a.id);a.fixImageSizeAndRotation(a.$imageElement).then(function(b){a.$imageElement.attr("src",b),a.$imageElement.attr("imager-attached",!0)}).fail(function(a){console.error(a)}),a.$imageElement.on("load.imagerInit",function(){a.$imageElement.off("load.imagerInit"),a.trigger("ready")})},h.prototype.fixImageSizeAndRotation=function(b){var c=this,d=a.Deferred(),e=b.attr("src");if(e.length<1)return a.when("");if(0===e.indexOf("data:image"))return this._fixBase64ImageSizeAndRotation(e);if(0===e.indexOf("http")){var f=new XMLHttpRequest;return f.responseType="blob",f.onload=function(){var a=new FileReader;a.onloadend=function(){c._fixBase64ImageSizeAndRotation(a.result).then(function(a){d.resolve(a)})},a.onerror=function(a){d.reject(a)},a.readAsDataURL(f.response)},f.open("GET",e),f.send(),d.promise()}return console.error("Unsupported image `src`!"),a.when("")},h.prototype._fixBase64ImageSizeAndRotation=function(b){function c(){var a=document.createElement("canvas");a.width=i.naturalWidth,a.height=i.naturalHeight;var b=a.getContext("2d");if("jpeg"===g||"jpg"===g)switch(h){case 2:b.translate(a.width,0),b.scale(-1,1);break;case 3:b.translate(a.width,a.height),b.rotate(Math.PI);break;case 4:b.translate(0,a.height),b.scale(1,-1);break;case 5:a.width=i.naturalHeight,a.height=i.naturalWidth,b.rotate(.5*Math.PI),b.scale(1,-1);break;case 6:a.width=i.naturalHeight,a.height=i.naturalWidth,b.translate(a.width,0),b.rotate(.5*Math.PI);break;case 7:a.width=i.naturalHeight,a.height=i.naturalWidth,b.rotate(.5*Math.PI),b.translate(a.width,-a.height),b.scale(-1,1);break;case 8:a.width=i.naturalHeight,a.height=i.naturalWidth,b.rotate(-.5*Math.PI),b.translate(-a.width,0)}if(b.drawImage(i,0,0),a.width>e.options.maxImageWidth){var c=e.options.maxImageWidth,j=100*e.options.maxImageWidth/a.width,k=j*a.height/100;e.log("Image is bigger than we could handle, resizing to",c,k),d.resizeImage(a,a.width,a.height,c,k)}f.resolve(a.toDataURL(e.options.format))}var e=this,f=a.Deferred(),g=e.getImageFormat(e.$imageElement.attr("src"));if("jpeg"===g||"jpg"===g){this.originalExif=piexif.load(b);var h=this.originalExif["0th"][piexif.ImageIFD.Orientation];this.originalExif["0th"][piexif.ImageIFD.Orientation]=1,b=piexif.insert(piexif.dump(this.originalExif),b)}var i=document.createElement("img");return i.onload=c,i.src=b,f.promise()},h.prototype.startSelector=function(){var b=this;this.$selectorContainer=a('<div class="imager-selector-container" tabindex="1"></div>');var c=function(){b.off("ready",c),b.startEditing(),b.$selectorContainer.remove(),b.$selectorContainer=null},f=function(){b.$imageElement.off("load",f),b.handleImageElementSrcChanged(),b.on("ready",c)},g=new d.FileSelector("image/*");g.onFileSelected(function(a){d.setWaiting(b.$selectorContainer,e.t("Please wait...")),setTimeout(function(){b.$imageElement.attr("src",a.data),b.$imageElement.css("height","auto"),b.$imageElement.css("min-height","inherit"),b.$imageElement.css("min-width","inherit"),b.$imageElement.on("load",f)},200)}),this.$selectorContainer.append(g.getElement()),a("body").append(this.$selectorContainer);var h=this.$imageElement.offset();this.$selectorContainer.css({left:h.left,top:h.top,width:this.$imageElement.width(),height:this.$imageElement.height()})},h.prototype.startEditing=function(){if(this.log("startEditing()"),this.hideOriginalImage(),!this.$imageElement[0].complete)throw new Error("Trying to start editing image that was not yet loaded. Please add `ready` event listener to imager.");this.originalPreviewWidth=this.$imageElement.width(),this.originalPreviewHeight=this.$imageElement.height(),this.$editContainer=a('<div class="imager-edit-container" tabindex="1"></div>'),this.options.editModeCss&&this.$editContainer.css(this.options.editModeCss),a("body").append(this.$editContainer),this._createEditCanvas(),this.adjustEditContainer(),this.trigger("editStart"),this.render(),this._isInEditMode=!0,this.$editContainer.focus();var b=this.getDataSize();b>this.options.imageSizeForPerformanceWarning&&d.setOverlayMessage(this.$editContainer,"Image is too big and could cause very poor performance.","default","Ok",function(){d.removeOverlayMessage(this.$editContainer)}.bind(this)),this._adjustElementsSize("toolbar-button",this.touchDevice?this.options.toolbarButtonSizeTouch:this.options.toolbarButtonSize),0===this.history.length&&this.commitChanges("Original"),this.trigger("historyChange")},h.prototype.stopEditing=function(){if(this._isInEditMode){this.showOriginalImage(),this.render();var b=this.invokePluginsMethod("serialize"),c={};a(b).each(function(a,b){c[b.name]=b.result});var d=null;try{d=this.canvas.toDataURL("image/"+this.options.format,this.quality)}catch(e){console.error(e.name&&"SecurityError"===e.name?"Failed to get image data from canvas because of security error.Usually this happens when image drawed on canvas is located on separate domain withoutproper access-control headers.":e)}d||console.error("Failed to get image data from canvas."),this.$imageElement.attr("src",d),this.$editContainer.remove(),this.$editContainer=null,this.canvas=null,this.tempCanvas=null,this.trigger("editStop",{imageData:d,pluginsData:c}),this._isInEditMode=!1}},h.prototype.setZindex=function(a){this.$editContainer&&this.$editContainer.css("z-index",a)},h.prototype.commitChanges=function(a,b){function c(){e.$imageElement.off("load",c),e.quality=f,e.targetScale=g,e.adjustCanvasSize(),e.history.push({message:a,image:h,width:e.$imageElement.width(),height:e.$imageElement.height()}),e.originalPreviewWidth=e.$imageElement.width(),e.originalPreviewHeight=e.$imageElement.height(),e.render(),e.trigger("historyChange"),b&&b instanceof Function&&b()}function d(a){console.warn("commitChanges() : image failed to load :",a),console.trace()}var e=this,f=this.quality,g=this.targetScale;this.quality=1,this.targetScale=1,this.adjustCanvasSize(),this.render();var h=this.canvas.toDataURL("image/"+this.options.format,100);this.$imageElement.on("load",c),this.$imageElement.on("error",d),this.$imageElement.attr("src",h)},h.prototype.isInEditMode=function(){return this._isInEditMode},h.prototype._createEditCanvas=function(){var b=this.$imageElement.width(),c=this.$imageElement.height(),d=this.$imageElement[0].naturalWidth,e=this.$imageElement[0].naturalHeight,f=a('<canvas class="imager-edit-canvas"/>');f.css({width:b,height:c}),this.canvas=f[0],this.adjustCanvasSize(),this.$editContainer.append(f),this.tempCanvas=document.createElement("canvas"),this.tempCanvas.width=d,this.tempCanvas.height=e,this.showTemporaryCanvas&&(a("body").append(this.tempCanvas),a(this.tempCanvas).css({position:"absolute",left:"50px",top:"50px",width:b}))},h.prototype.render=function(a){a=void 0!==a?a:this.canvas.getContext("2d");var b=this.$imageElement[0].naturalWidth,c=this.$imageElement[0].naturalHeight;if(0===b||0===c)return console.warn("Trying to render canvas with zero width or height"),void console.trace();a.canvas.width=b*this.targetScale,a.canvas.height=c*this.targetScale,this.tempCanvas.width=b,this.tempCanvas.height=c;var d=a.canvas.width,e=a.canvas.height,f={sourceLeft:0,sourceTop:0,sourceWidth:b,sourceHeight:c,destLeft:0,destTop:0,destWidth:d,destHeight:e,paddingWidth:0,paddingHeight:0};this.drawImage(this.$imageElement,a,f),this.invokePluginsMethod("render",a)},h.prototype.clearCanvas=function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height),"jpeg"==this.options.format&&(a.fillStyle="#FFFFFF",a.fillRect(0,0,a.canvas.width,a.canvas.height))},h.prototype.drawImage=function(a,b,c){return 0===b.canvas.width||0===b.canvas.height?void console.warn("Imager.drawImage() : Trying to render canvas with either width or height equal to 0"):void this._drawWithScaling(a,b,this.tempCanvas.getContext("2d"),c.sourceLeft,c.sourceTop,c.sourceWidth,c.sourceHeight,c.destLeft,c.destTop,c.destWidth,c.destHeight,c.paddingWidth,c.paddingHeight)},h.prototype._drawWithScaling=function(a,b,c,d,e,f,g,h,i,j,k,l,m){l=void 0!==l?l:0,m=void 0!==m?m:0,d=void 0!==d?d:0,e=void 0!==e?e:0;var n=l/2,o=m/2,p=c.canvas;c.clearRect(0,0,f,g);var q=a[0],r=3,s=.5,t=f,u=g,v=d,w=e;c.drawImage(q,v,w,f,g,0,0,t,u);for(var x=0;r>x&&!(2*j>=t||2*k>=u);x++){var y=t,z=u;t*=s,u*=s,v*=s,w*=s;var A=document.createElement("canvas");A.width=c.canvas.width,A.height=c.canvas.height;var B=A.getContext("2d");B.clearRect(0,0,A.width,A.height),B.drawImage(p,v,w,y,z,0,0,t,u),c.clearRect(0,0,c.canvas.width,c.canvas.height),c.drawImage(A,0,0,t,u,0,0,t,u)}b.clearRect(0,0,b.canvas.width,b.canvas.height),b.drawImage(p,0,0,t,u,h+n,i+o,j-l,k-m)},h.prototype.setPreviewSize=function(b,c){this.$imageElement.css({width:b,height:c}),a(this.canvas).css({width:b,height:c}),a("body").trigger("imagerResize"),this.log("resize trigger"),this.originalPreviewWidth=this.$imageElement.width(),this.originalPreviewHeight=this.$imageElement.height()},h.prototype.getPreviewSize=function(){return{width:this.$imageElement.width(),height:this.$imageElement.height()}},h.prototype.getImageRealSize=function(){return{width:this.$imageElement[0].naturalWidth,height:this.$imageElement[0].naturalHeight}},h.prototype.getCanvasSize=function(){return{width:this.canvas.width,height:this.canvas.height}},h.prototype.convertScale=function(a,b,c){var d=100*a/b;return d*c/100},h.prototype.hideOriginalImage=function(){this.$imageElement.css("opacity",0)},h.prototype.showOriginalImage=function(){this.$imageElement.css("opacity",1)},h.prototype.adjustCanvasSize=function(){var a=this.getImageRealSize(),b=this.getPreviewSize(),c=0,d=0,e=0;if(b.width>b.height?(c=a.width,e=100*b.height/b.width,d=e*c/100):(d=a.height,e=100*b.width/b.height,c=e*d/100),this.canvas.width=c*this.targetScale,this.canvas.height=d*this.targetScale,this.canvasSizeLimit=1048576,this.canvasSizeLimit&&this.canvas.width*this.canvas.height>this.canvasSizeLimit){console.warn("adjustCanvasSize(): canvas size is too big : ",this.canvas.width,this.canvas.height);var f=.95*this.canvasSizeLimit/(this.canvas.width*this.canvas.height);this.canvas.width=this.canvas.width*f,this.canvas.height=this.canvas.height*f,console.warn("adjustCanvasSize(): canvas was reduced to : ",this.canvas.width,this.canvas.height)}},h.prototype.adjustEditContainer=function(){var a=this,b=a.$imageElement.offset();a.$editContainer&&a.$editContainer.css({left:b.left,top:b.top,width:a.$imageElement.width(),height:a.$imageElement.height()}),a.$selectorContainer&&a.$selectorContainer.css({left:b.left,top:b.top,width:this.$imageElement.width(),height:this.$imageElement.attr("src")?this.$imageElement.height():"auto"})},h.prototype.restoreOriginal=function(){this.$imageElement.replaceWith(this.$originalImage)},h.prototype.historyUndo=function(){function a(){b.$imageElement.off("load",a),b.originalPreviewWidth=b.$imageElement.width(),b.originalPreviewHeight=b.$imageElement.height(),b.setPreviewSize(c.width,c.height),b.render(),b.history.splice(b.history.length-1,1),b.trigger("historyChange")}if(!(this.history.length<2)){var b=this,c=this.history[this.history.length-2];this.$imageElement.on("load",a),this.$imageElement.attr("src",c.image),this.$imageElement.width(c.width),this.$imageElement.height(c.height)}},h.prototype.remove=function(a){this.trigger("remove"),this.$imageElement.removeAttr("imager-attached"),this.stopEditing(),this.showOriginalImage();var b=f.indexOf(this);f.splice(b,1),this.$originalImage=null,this.pluginsInstances=null,a&&this.$imageElement.remove()},h.prototype.getDataSize=function(){var a="data:image/"+this.options.format+";base64,",b=this.canvas.toDataURL("image/"+this.options.format,this.quality),c=Math.round(3*(b.length-a.length)/4);return c},h.getImagerFor=function(b){for(var c=0;c<f.length;c++){var d=f[c];if(d.id==a(b).attr("data-imager-id"))return d}return void 0},h.isImagerAttached=function(b){return void 0!==a(b).attr("imager-attached")},h.prototype.setWaiting=function(a){a?this.$editContainer&&d.setWaiting(this.$editContainer,e.t("Please wait..."),this.options.waitingCursor):d.stopWaiting(this.$editContainer)},h.prototype.getImageFormat=function(a){if(a){var b;return 0===a.indexOf("http")?(b=a.split(".").pop(),"jpeg"==b?b="jpeg":"jpg"==b?b="jpeg":"png"==b&&(b="png")):0===a.indexOf("data:image")&&("j"==a[11]?b="jpeg":"p"==a[11]&&(b="png")),b}},h.prototype._adjustElementsSize=function(b,c){for(var d=a("[data-sizeable="+b+"]"),e=0;e<d.length;e++)for(var f=d[e],g=a(f).attr("data-cssrules").split(","),h=0;h<g.length;h++){var i=g[h],j=c;"-"==i[0]&&(i=i.substr(1),j="-"+c);var k=i.match(/:\((.+)\)/);if(k){i=i.replace(k[0],"");var l=k[1];l=l.replace("$v",j);var m=new Function("return "+l)();j=m}a(f).css(i,j+"px")}},h.prototype.detectPlatform=function(){/iPhone|iPad|iPod/i.test(navigator.userAgent)?this.platform=g.ios:/Android|BlackBerry/i.test(navigator.userAgent)?this.platform=g.android:/IEMobile/i.test(navigator.userAgent)&&(this.platform=g.windowsMobile),this.options.detectTouch&&"Function"!==this.options.detectTouch.constructor.name&&(console.error("detectTouch should be a function which will be called when Imager needs to determine whether it is working on touch device"),this.options.detectTouch=null),this.touchDevice=this.options.detectTouch?this.options.detectTouch(this):/(iPhone|iPod|iPad|BlackBerry|Android)/i.test(navigator.userAgent);var b=this;a("body").on("touchstart.DrawerTouchCheck",function(){b.touchDevice=!0,a("body").off("touchstart.DrawerTouchCheck"),b.log("Found touch screen.")})},b.Imager=h}(jQuery,ImagerJs,ImagerJs.plugins,ImagerJs.util,ImagerJs.translations),function(a,b,c){var d=function(b){var d=this;d.acceptTypes=b,d.$element=a('<div class="file-selector"><input type="file" /><div class="drop-area">'+c.t("Or drop files here")+'</div><div class="error-container bg-danger"></div></div>'),d.acceptTypes&&d.$element.find("input").attr("accept",d.acceptTypes),d.$element.find("input").on("change",function(a){a.target.files.length<1&&d.showError(c.t("No file selected."));for(var b=0;b<a.target.files.length;b++)if(a.target.files[b].type.indexOf("image")<0)return void d.showError(c.t("Incorrect file type"));d.parseFile(a.target.files[0])});var e=d.$element.find(".drop-area");e.on("dragover",function(a){a.stopPropagation(),a.preventDefault(),e.addClass("hover")}),e.on("dragleave",function(a){a.stopPropagation(),a.preventDefault(),e.removeClass("hover")}),e.on("drop",function(a){a.stopPropagation(),a.preventDefault(),e.removeClass("hover");var b=a.originalEvent.dataTransfer.files;if(b.length<1)return void d.showError(c.t("No file selected."));for(var f=0;f<b.length;f++)if(b[f].type.indexOf("image")<0)return void d.showError(c.t("Incorrect file type."));d.parseFile(b[0])})};d.prototype.parseFile=function(a){var b=this,c=new FileReader;c.onload=function(){b.$element.trigger("fileSelected.fileSelector",{info:a,data:c.result})},c.readAsDataURL(a)},d.prototype.onFileSelected=function(a){var b=this;b.$element.on("fileSelected.fileSelector",function(b,c){a(c)})},d.prototype.showError=function(a){var b=this;b.$element.find(".error-container").html(a),b.$element.find(".error-container").slideDown(200),setTimeout(function(){b.$element.find(".error-container").slideUp(200)},2e3)},d.prototype.getElement=function(){return this.$element},d.prototype.hide=function(){this.$element.hide()},d.prototype.show=function(){this.$element.show()},b.FileSelector=d}(jQuery,ImagerJs.util,ImagerJs.translations),function(a,b){b.uuid=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}}(jQuery,ImagerJs.util),function(a,b){"use strict";b.getDrawerFolderUrl=function(){for(var a=document.getElementsByTagName("script"),b=/dist\/(drawer.+\.js)+$/,c=0;c<a.length;c++){var d=a.item(c);if(d.src){var e=d.src.match(b);if(e){var f=d.src.replace(e[1],"");return f}}}return null},b.unbindClick=function(b,c){var d=c+"drawerBindClick";a(b).off("click."+d),a(b).off("touchstart."+d),a(b).off("touchend."+d)},b.bindClick=function(b,c,d){var e=c+"drawerBindClick";a(b).on("click."+e,function(a){var b=this,c=null;if(b.__lastClickTime){var e=Date.now()-b.__lastClickTime;if(e>500&&(c=d.apply(b,[a]),c===!1))return a.stopPropagation(),a.preventDefault(),!1}else if(c=d.apply(b,[a]),c===!1)return a.stopPropagation(),a.preventDefault(),!1}),a(b).on("touchstart."+e,function(c){var d=this;d.__drawerTouchStartEvent=c,a(b).off("click."+e)}),a(b).on("touchend."+e,function(a){var b=this;if(b.__drawerTouchStartEvent){var c=Math.abs(b.__drawerTouchStartEvent.timeStamp-a.timeStamp);if(300>c){b.__lastClickTime=Date.now();var e=d.apply(b,[a]);if(e===!1)return a.stopPropagation(),a.preventDefault(),!1}delete b.__drawerTouchStartEvent}})},b.bindDoubleTap=function(b,c,d){var e=500,f=20;a(b).on("touchend."+c,function(a){var b=this;if(b.__touchEndTime){var c=Date.now()-b.__touchEndTime,g=Math.abs(b.__touchEndX-a.originalEvent.pageX),h=Math.abs(b.__touchEndY-a.originalEvent.pageY);if(e>c&&f>g&&f>h){delete b.__touchEndTime,delete b.__touchEndX,delete b.__touchEndY;var i=d.apply(b,[a]);if(i===!1)return a.stopPropagation(),a.preventDefault(),!1}else delete b.__touchEndTime,delete b.__touchEndX,delete b.__touchEndY}else b.__touchEndTime=Date.now(),b.__touchEndX=a.originalEvent.pageX,b.__touchEndY=a.originalEvent.pageY,setTimeout(function(){delete b.__touchEndTime,delete b.__touchEndX,delete b.__touchEndY},e)})},b.bindLongPress=function(b,c,d){var e="drawerBindLongPress",f=c+e;a(b).on("touchstart."+f,function(b){var c=this;c.__touchStartTime=Date.now(),c.__touchStartX=b.originalEvent.pageX,c.__touchStartY=b.originalEvent.pageY,c.__longPressCheckTimeout&&clearTimeout(c.__longPressCheckTimeout);var e=function(){delete c.__touchStartTime,delete c.__touchStartX,delete c.__touchStartY,a(c).off("touchmove."+f),a(c).off("touchend."+f)};return a(c).on("touchmove."+f,function(a){if(c.__touchStartTime){var b=Math.abs(c.__touchStartX-a.originalEvent.pageX),d=Math.abs(c.__touchStartY-a.originalEvent.pageY);(b>10||d>10)&&e()}}),a(c).on("touchend."+f,function(){e()}),c.__longPressCheckTimeout=setTimeout(function(){if(c.__touchStartTime){e();{d.apply(c,[b])}}},1e3),!0})},b.unbindLongPress=function(b,c){var d="drawerBindLongPress",e=c+d;a(b).off("touchstart."+e),a(b).off("touchmove."+e),a(b).off("touchend."+e)},b.mouseDown=function(a){return"mousedown."+a+" touchstart."+a},b.mouseMove=function(a){return"mousemove."+a+" touchmove."+a},b.mouseUp=function(a){return"mouseup."+a+" touchend."+a},b.getTransitionDuration=function(a,b){var c=window.getComputedStyle(a),d=c.webkitTransitionDuration,e=c.webkitTransitionDelay;return d=d.indexOf("ms")>-1?parseFloat(d):1e3*parseFloat(d),e=e.indexOf("ms")>-1?parseFloat(e):1e3*parseFloat(e),b?d+e:d},b.getEventPosition=function(a){return a.type.indexOf("touch")>-1&&(a=a.originalEvent,0===a.pageX&&0===a.pageY||void 0===a.pageX&&void 0===a.pageY&&a.touches.length>0)?{left:a.touches[0].pageX,top:a.touches[0].pageY}:{left:a.pageX,top:a.pageY}},b.isShape=function(a){var b=!1;return b=!a.type||"line"!=a.type&&"arrow"!=a.type?a.path?!1:!0:!1},b.__temporaryCanvas=null,b.getTemporaryCanvas=function(a){return b.__temporaryCanvas||(b.__temporaryCanvas=document.createElement("canvas")),b.__temporaryCanvas.setAttribute("width",a.width),b.__temporaryCanvas.setAttribute("height",a.height),b.__temporaryCanvas},b.LastCoordsQueue=function(){this.coordsQueue=[],this.length=10,this.pushCoords=function(a,b){this.coordsQueue.length>this.length&&(this.coordsQueue=this.coordsQueue.slice(this.coordsQueue.length-this.length)),this.coordsQueue.push({x:a,y:b})},this.getInterpolatedValues=function(){if(0===this.coordsQueue.length)return[];if(1===this.coordsQueue.length)return[{x:this.coordsQueue[0].x,y:this.coordsQueue[0].y}];for(var a=[],b=this.coordsQueue[this.coordsQueue.length-2].x,c=this.coordsQueue[this.coordsQueue.length-2].y,d=this.coordsQueue[this.coordsQueue.length-1].x,e=this.coordsQueue[this.coordsQueue.length-1].y,f=d-b,g=e-c,h=Math.abs(f),i=Math.abs(g),j=h>i?h:i,k=0;j>k;k++)a.push({x:b+f/j*k,y:c+g/j*k});return a}},b.setWaiting=function(a,c,d){d||(d="wait"),b.setOverlayMessage(a,c,d)},b.stopWaiting=function(a){b.removeOverlayMessage(a)},b.setOverlayMessage=function(c,d,e,f,g){e||(e="default");var h=f?'<div class="action-button">'+f+"</div>":"";a(c).append('<div class="overlay-message-wrapper"><div class="overlay-message">'+d+h+"</div></div>"),a(c).find(".overlay-message-wrapper").css("cursor",e),b.bindClick(a(c).find(".action-button"),"overlay-message-click",g)},b.removeOverlayMessage=function(b){a(b).find(".overlay-message-wrapper").remove()},b.resizeImage=function(a,b,c,d,e){Date.now();d=Math.round(d),e=Math.round(e);for(var f=a.getContext("2d").getImageData(0,0,b,c),g=a.getContext("2d").getImageData(0,0,d,e),h=f.data,i=g.data,j=b/d,k=c/e,l=Math.ceil(j/2),m=Math.ceil(k/2),n=0;e>n;n++)for(var o=0;d>o;o++){for(var p=4*(o+n*d),q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=(n+.5)*k,y=Math.floor(n*k);(n+1)*k>y;y++)for(var z=Math.abs(x-(y+.5))/m,A=(o+.5)*j,B=z*z,C=Math.floor(o*j);(o+1)*j>C;C++){var D=Math.abs(A-(C+.5))/l,E=Math.sqrt(B+D*D);E>=-1&&1>=E&&(q=2*E*E*E-3*E*E+1,q>0&&(D=4*(C+y*b),w+=q*h[D+3],s+=q,h[D+3]<255&&(q=q*h[D+3]/250),t+=q*h[D],u+=q*h[D+1],v+=q*h[D+2],r+=q))}i[p]=t/r,i[p+1]=u/r,i[p+2]=v/r,i[p+3]=w/s}a.getContext("2d").clearRect(0,0,Math.max(b,d),Math.max(c,e)),a.width=d,a.height=e,a.getContext("2d").putImageData(g,0,0)}}(jQuery,ImagerJs.util),function(a,b,c,d){var e=c.mouseDown("imagerjsCrop"),f=c.mouseUp("imagerjsCrop"),g=c.mouseMove("imagerjsCrop"),h=function(b,c){var d=this;d.weight=0,d.imager=b,d.defaultOptions={controlsCss:{},controlsTouchCss:{}},c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c),d.originalWidth=null,d.originalHeight=null,d.croppedWidth=null,d.croppedHeight=null,d.croppedLeft=null,d.croppedTop=null};h.prototype.getButtons=function(){var a=this;return[{classes:"btn-crop",
iconClasses:"fa-scissors",tooltip:d.t("Crop"),enabledHandler:function(){a.sizeBeforeCrop&&a.imager.setPreviewSize(a.sizeBeforeCrop.width,a.sizeBeforeCrop.height),a.enableRendering=!1,a.imager.render(),a.startCropping()},applyHandler:function(){a.sizeBeforeCrop=a.imager.getPreviewSize(),a.stopCropping(),a.enableRendering=!0,a.imager.setPreviewSize(a.croppedWidth,a.croppedHeight),a.imager.setWaiting(!0),setTimeout(function(){a.imager.commitChanges("Crop"),a.reset(),a.imager.render(),a.imager.setWaiting(!1)},50)},rejectHandler:function(){a.stopCropping(),a.croppedWidth=null,a.croppedHeight=null,a.croppedLeft=null,a.croppedTop=null,a.imager.render()}}]},h.prototype.startCropping=function(){function b(){d.$cropControls.css({left:d.croppedLeft,top:d.croppedTop,width:d.croppedWidth,height:d.croppedHeight}),d.adjustPreview()}var d=this;d.renderCropped=!1,d.imager.render(),$body=a("body");var h=this.imager.getPreviewSize();d.originalWidth=h.width,d.originalHeight=h.height,d.makePreview(),d.$cropControls=a('<div class="imager-crop-container"><div class="crop-corner crop-top-left"></div><div class="crop-corner crop-top-right"></div><div class="crop-corner crop-bottom-right"></div><div class="crop-corner crop-bottom-left"></div><div class="crop-border crop-border-top"></div><div class="crop-border crop-border-right"></div><div class="crop-border crop-border-bottom"></div><div class="crop-border crop-border-left"></div></div>').css({width:d.croppedWidth?d.croppedWidth:d.originalWidth,height:d.croppedHeight?d.croppedHeight:d.originalHeight,left:d.croppedLeft?d.croppedLeft:0,top:d.croppedTop?d.croppedTop:0}),d.imager.$editContainer.append(d.$cropControls);var i=d.$cropControls,j=i.find(".crop-corner");j.css(d.imager.touchDevice?d.options.controlsTouchCss:d.options.controlsCss),j.on(e,function(e){e.stopPropagation();var h=this,i=c.getEventPosition(e),j=0|d.$cropControls.css("left").replace("px",""),k=0|d.$cropControls.css("top").replace("px",""),l=0|d.$cropControls.css("width").replace("px",""),m=0|d.$cropControls.css("height").replace("px","");$body.on(g,function(e){function f(){d.croppedLeft<0&&(d.croppedLeft=0),d.croppedTop<0&&(d.croppedTop=0),d.croppedLeft+d.croppedWidth>d.originalWidth&&(d.croppedWidth=d.originalWidth-d.croppedLeft),d.croppedTop+d.croppedHeight>d.originalHeight&&(d.croppedHeight=d.originalHeight-d.croppedTop)}var g=c.getEventPosition(e),n=g.left-i.left,o=g.top-i.top;return a(h).hasClass("crop-top-left")&&(d.croppedLeft=j+n,d.croppedTop=k+o,d.croppedWidth=l-n,d.croppedHeight=m-o,e.shiftKey&&(f(),d.croppedHeight<d.croppedWidth?(d.croppedWidth=d.croppedHeight,d.croppedLeft=l-d.croppedHeight+j):(d.croppedHeight=d.croppedWidth,d.croppedTop=m-d.croppedWidth+k))),a(h).hasClass("crop-top-right")&&(d.croppedLeft=j,d.croppedTop=k+o,d.croppedWidth=l- -1*n,d.croppedHeight=m-o,e.shiftKey&&(f(),d.croppedHeight<d.croppedWidth?d.croppedWidth=d.croppedHeight:(d.croppedHeight=d.croppedWidth,d.croppedTop=m-d.croppedHeight+k))),a(h).hasClass("crop-bottom-right")&&(d.croppedLeft=j,d.croppedTop=k,d.croppedWidth=l- -1*n,d.croppedHeight=m+o,e.shiftKey&&(f(),d.croppedHeight<d.croppedWidth?d.croppedWidth=d.croppedHeight:d.croppedHeight=d.croppedWidth)),a(h).hasClass("crop-bottom-left")&&(d.croppedLeft=j+n,d.croppedTop=k,d.croppedWidth=l-n,d.croppedHeight=m+o,e.shiftKey&&(f(),d.croppedHeight<d.croppedWidth?(d.croppedWidth=d.croppedHeight,d.croppedLeft=j+(l-d.croppedWidth)):d.croppedHeight=d.croppedWidth)),f(),b(),e.preventDefault(),e.stopPropagation(),!1}),$body.on(f,function(){$body.off(g),$body.off(f)})}),i.on(e,function(a){var e=c.getEventPosition(a),h=0|d.$cropControls.css("left").replace("px",""),i=0|d.$cropControls.css("top").replace("px","");$body.on(g,function(a){var f=c.getEventPosition(a),g=f.left-e.left,j=f.top-e.top;return d.croppedLeft=h+g,d.croppedTop=i+j,d.croppedLeft<0&&(d.croppedLeft=0),d.croppedTop<0&&(d.croppedTop=0),d.croppedLeft+d.croppedWidth>d.originalWidth&&(d.croppedLeft=d.originalWidth-d.croppedWidth),d.croppedTop+d.croppedHeight>d.originalHeight&&(d.croppedTop=d.originalHeight-d.croppedHeight),b(),a.preventDefault(),a.stopPropagation(),!1}),$body.on(f,function(){$body.off(g),$body.off(f)})})},h.prototype.stopCropping=function(){this.$preview.remove(),this.$preview=null,this.$cropControls.remove(),this.$cropControls=null,this.renderCropped=!0},h.prototype.makePreview=function(){var b=this,c=this.imager.getPreviewSize();b.$preview=a('<div class="imager-crop-preview-container"><canvas class="imager-crop-preview"></canvas></div>').css("position","absolute").css("top","50px").css({width:c.width,height:c.height,position:"absolute",right:"50px",top:"50px"}),b.previewCanvas=b.$preview.find("canvas.imager-crop-preview")[0],b.previewCanvas.__previewCanvas=!0,b.previewCanvas.width=1.5*c.width,b.previewCanvas.height=1.5*c.height,a(b.previewCanvas).css({height:"400px"}),b.imager.$editContainer.after(this.$preview)},h.prototype.adjustPreview=function(){},h.prototype.render=function(a){if(null!==this.croppedWidth&&this.enableRendering){var b=this.imager.getPreviewSize(),c=b.width,d=b.height;this.sizeBeforeCrop&&(c=this.sizeBeforeCrop.width,d=this.sizeBeforeCrop.height);var e=this.imager.tempCanvas.getContext("2d"),f=this.imager.convertScale(this.croppedWidth,c,a.canvas.width),g=this.imager.convertScale(this.croppedHeight,d,a.canvas.height),h=this.imager.convertScale(this.croppedLeft,c,a.canvas.width),i=this.imager.convertScale(this.croppedTop,d,a.canvas.height);h*=-1,i*=-1;var j=a.canvas.width-f,k=a.canvas.height-g;e.canvas.width=f,e.canvas.height=g,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,h,i,e.canvas.width+j,e.canvas.height+k),a.canvas.width=f,a.canvas.height=g,this.imager.clearCanvas(a),a.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height,0,0,a.canvas.width,a.canvas.height)}},h.prototype.onToolSelected=function(a){"RotatePlugin"==a.plugin.constructor.name&&(this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null)},h.prototype.deserialize=function(a){a&&(this.croppedLeft=croppedLeft,this.croppedTop=croppedTop,this.croppedWidth=croppedWidth,this.croppedHeight=croppedHeight,this.sizeBeforeCrop=sizeBeforeCrop)},h.prototype.serialize=function(){return{croppedLeft:this.croppedLeft,croppedTop:this.croppedTop,croppedWidth:this.croppedWidth,croppedHeight:this.croppedHeight,sizeBeforeCrop:this.sizeBeforeCrop}},h.prototype.reset=function(){this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null},b.Crop=h}(jQuery,ImagerJs.plugins,ImagerJs.util,ImagerJs.translations),function(a,b,c){var d=function(b,c){var d=this;d.imager=b,d.defaultOptions={fullRemove:!1},c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c),d.weight=500};d.prototype.getButtons=function(){var a=this;return[{classes:"btn-delete",iconClasses:"fa-times",tooltip:c.t("Delete image"),enabledHandler:function(){var b=c.t("Are you sure want to delete this image?"),d=confirm(b);d&&(a.imager.setWaiting(!0),setTimeout(function(){a.options.fullRemove?a.imager.remove(!0):(a.imager.stopEditing(),a.imager.$imageElement.attr("src",""),a.imager.startSelector(),a.imager.adjustEditContainer())},1))}}]},b.Delete=d}(jQuery,ImagerJs.plugins,ImagerJs.translations,ImagerJs.util),function(a,b,c,d,e){"use strict";var f=c.mouseDown("MovableFloatingMode"),g=c.mouseMove("MovableFloatingMode"),h=c.mouseUp("MovableFloatingMode"),i=function(b,c){var d=this;d.imager=b,d.defaultOptions={minWidth:50,minHeight:50},c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c),d.weight=100,d.imager.log("[PropertiesPlugin]","init")};i.prototype.getButtons=function(){var a=this;return[{classes:"btn-properties",iconClasses:"fa-cog",tooltip:d.t("Image properties"),enabledHandler:function(){a.showPropertiesModal()}}]},i.prototype.showPropertiesModal=function(){var b=this,c=new e;c.setTitle(d.t("Image properties")),c.addClass("canvas-properties imager-click-stop");var f=a('<div class="image-properties"><form class="image-size-form"><div class="form-group"><label for="image-properties-width">'+d.t("Size:")+' </label><input type="text" class="form-control" id="image-properties-width" placeholder="'+d.t("width in px")+'"><span>x</span><input type="email" class="form-control" id="image-properties-height" placeholder="'+d.t("height in px")+'"></div></form><br><form class="aligment"><div class="form-group"><label for="image-properties-layout">Aligment:</label><select id="image-properties-layout" class="form-control layout-selector"><option value="left">'+d.t("Left")+'</option><option value="right">'+d.t("Right")+'</option><option value="center">'+d.t("Center")+'</option><option value="inline">'+d.t("Inline")+'</option><option value="floating">'+d.t("Floating")+'</option></select></div></form><form class="background-transparency"><div class="form-group"><input id="image-properties-transparent-background" type="checkbox" checked><label for="image-properties-transparent-background">'+d.t("Transparent background")+"</label></div></form></div>");"floating"==this.getAlign()?f.find(".background-transparency").show():f.find(".background-transparency").hide();var g=b.imager.$imageElement.css("background-color");"transparent"==g||"rgba(0, 0, 0, 0)"==g?f.find("#image-properties-transparent-background").attr("checked","checked"):f.find("#image-properties-transparent-background").removeAttr("checked");var h=this.imager.getPreviewSize(),i=h.height/h.width,j=h.width/h.height,k=this.getAlign();f.find("#image-properties-width").val(h.width),f.find("#image-properties-width").on("change keyup",function(){var a=f.find("#image-properties-width").val(),b=Math.floor(a*i);f.find("#image-properties-height").val(b)}),f.find("#image-properties-height").val(h.height),f.find("#image-properties-height").on("change keyup",function(){var a=f.find("#image-properties-height").val(),b=Math.floor(a*j);f.find("#image-properties-width").val(b)}),f.find("#image-properties-layout").val(k),f.find("#image-properties-layout").change(function(){"floating"==a("#image-properties-layout").val()?f.find(".background-transparency").show():f.find(".background-transparency").hide()}),c.setTemplate(f),c.addCancelButton(d.t("Cancel"),function(){c.remove()}),c.addActionButton(d.t("Apply"),function(){var d=a("#image-properties-width").val(),e=a("#image-properties-height").val(),f=a("#image-properties-layout").val(),g=a("#image-properties-transparent-background").attr("checked");g?(b.imager.$editContainer.css("background","transparent"),b.imager.$imageElement.css("background","transparent")):(b.imager.$editContainer.css("background","white"),b.imager.$imageElement.css("background","white")),b.imager.render(),f!=b.getAlign()&&b.setAlign(f),b.imager.setPreviewSize(d,e),c.remove()}),c.show()},i.prototype.setAlign=function(a){var b={};"floating"==a?(b.position="absolute",b.display="block",b["float"]="none",b.left="0px",b.top="0px"):"center"==a?(b["float"]="none",b["margin-left"]="auto",b["margin-right"]="auto",b.display="block",b.position="static"):"inline"==a?(b["float"]="none",b.display="inline-block",b.position="static"):(b.display="block",b["float"]=a,b.position="static"),this.imager.$imageElement.css(b),this.onEditStart(),this.imager.adjustEditContainer()},i.prototype.getAlign=function(){var a=this.imager.$imageElement.css(["position","float","display","margin-left","margin-right"]),b="inline";return"absolute"==a.position?b="floating":"left"==a["float"]?b="left":"right"==a["float"]?b="right":"block"==a.display&&"auto"==a["margin-left"]&&(b="center"),b},i.prototype.onEditStart=function(){var a=this.getAlign();"floating"==a?this.makeMoveButton():this.$moveButton&&(this.$moveButton.remove(),this.$moveButton=null)},i.prototype.makeMoveButton=function(){var b=this,c=b.imager.getPluginInstance("Toolbar").toolbar,e=a("body");this.$moveButton=c.addButton("btn-move","fa-arrows",d.t("Move image"),function(){}),this.$moveButton.on(f,function(c){c.type.indexOf("touch")>-1&&(c=c.originalEvent),a(".tooltip-btn-move").css("display","none");var d=0|b.imager.$imageElement.css("left").replace("px",""),f=0|b.imager.$imageElement.css("top").replace("px",""),i=c.pageX,j=c.pageY;e.on(g,function(a){a.type.indexOf("touch")>-1&&(a=a.originalEvent);var c=a.pageX-i,e=a.pageY-j,g=d+c,h=f+e;return 0>g&&(g=0),0>h&&(h=0),b.imager.$imageElement.css({left:g,top:h}),b.imager.adjustEditContainer(),a.preventDefault(),a.stopPropagation(),!1}),e.on(h,function(){a(".tooltip-btn-move").css("display","block"),e.off(g),e.off(h)})})},b.Properties=i}(jQuery,ImagerJs.plugins,ImagerJs.util,ImagerJs.translations,window.Modal),function(a,b,c){var d=c.mouseDown("imagerjsResize"),e=c.mouseUp("imagerjsResize"),f=c.mouseMove("imagerjsResize"),g=function(b,c){var d=this;d.imager=b,d.defaultOptions={minWidth:50,minHeight:50,controlsCss:{},controlsTouchCss:{},doubleDiff:!1},c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c),d.weight=99999};g.prototype.onToolSelected=function(){this.$resizeSquare&&this.$resizeSquare.addClass("hidden")},g.prototype.onToolApply=function(){this.$resizeSquare&&this.$resizeSquare.removeClass("hidden")},g.prototype.onToolReject=function(){this.$resizeSquare&&this.$resizeSquare.removeClass("hidden")},g.prototype.onEditStart=function(){var b=this,g=a('<div class="resize-square"></div>');g.css(b.imager.touchDevice?b.options.controlsTouchCss:b.options.controlsCss),b.imager.$editContainer.append(g);var h=a("body");g.on(d,function(a){{var d=c.getEventPosition(a),g=b.imager.getPreviewSize();g.height/g.width,g.width/g.height}return h.on(f,function(a){var e=c.getEventPosition(a),f=e.left-d.left,h=e.top-d.top;b.options.doubleDiff&&(f*=2,h*=2);var i=g.width+f,j=g.height+h,k=b.calcAspectRatio(g.width,g.height,i,j);return i=k.width,j=k.height,i<b.options.minWidth&&(i=b.options.minWidth),j<b.options.minHeight&&(j=b.options.minHeight),b.imager.setPreviewSize(i,j),a.stopPropagation(),a.preventDefault(),!1}),h.on(e,function(){h.off(e),h.off(f)}),a.stopPropagation(),a.preventDefault(),!1}),this.$resizeSquare=g},g.prototype.calcAspectRatio=function(a,b,c,d){var e=Math.min(c/a,d/b);return{width:a*e,height:b*e}},b.Resize=g}(jQuery,ImagerJs.plugins,ImagerJs.util),function(a,b,c,d){var e=c.mouseDown("imagerjsRotate"),f=c.mouseUp("imagerjsRotate"),g=c.mouseMove("imagerjsRotate"),h=function(b,c){var d=this;d.imager=b,d.defaultOptions={controlsCss:{},controlsTouchCss:{}},c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c),d.weight=-100,d.angle=0;var e=this.imager.getPreviewSize();d.controlsStartWidth=e.width,d.controlsStartHeight=e.height,d.widthDiff=0,d.heightDiff=0};h.prototype.getButtons=function(){var a=this,b={name:"Rotate",tooltip:d.t("Rotate")};return[{classes:"btn-rotate",iconClasses:"fa-repeat",tooltip:d.t("Rotate manually"),group:b,enabledHandler:function(){a.startRotate(),a.imager.render()},applyHandler:function(){a.imager.setWaiting(!0),setTimeout(function(){a.applyHandler(),a.imager.commitChanges("Rotate"),a.reset(),a.imager.setWaiting(!1)},50)},rejectHandler:function(){a.setAngle(0),a.stopRotate()}},{group:b,classes:"btn-rotate btn-rotate-90",iconClasses:"fa-undo",tooltip:d.t("Rotate 90 left"),enabledHandler:function(){a.imager.setWaiting(!0),setTimeout(function(){a.rotateByAngle(-90*Math.PI/180),a.imager.setWaiting(!1)},50)}},{group:b,classes:"btn-rotate",iconClasses:"fa-repeat",tooltip:d.t("Rotate 90 right"),enabledHandler:function(){a.imager.setWaiting(!0),setTimeout(function(){a.rotateByAngle(90*Math.PI/180),a.imager.setWaiting(!1)},50)}}]},h.prototype.applyHandler=function(){this.stopRotate()},h.prototype.rotateByAngle=function(a){var b=this.imager.quality,c=this.imager.targetScale;this.imager.quality=1,this.imager.targetScale=1,this.startRotate(),this.imager.render(),this.setAngle(a),this.imager.render(),this.stopRotate(),this.imager.commitChanges(d.t("Rotate")),this.reset(),this.imager.render(),this.imager.quality=b,this.imager.targetScale=c},h.prototype.startRotate=function(){{var b=this;this.imager.getPreviewSize()}b.controlsStartWidth=b.imager.originalPreviewWidth,b.controlsStartHeight=b.imager.originalPreviewHeight;var d=a('<div class="imager-rotate-container"><div class="rotate-corner rotate-top-left"></div><div class="rotate-corner rotate-top-right"></div><div class="rotate-corner rotate-bottom-right"></div><div class="rotate-corner rotate-bottom-left"></div><div class="rotate-border rotate-border-top"></div><div class="rotate-border rotate-border-right"></div><div class="rotate-border rotate-border-bottom"></div><div class="rotate-border rotate-border-left"></div></div>').css({width:b.controlsStartWidth,height:b.controlsStartHeight});this.$rotateControls=d,this.imager.$editContainer.append(d);var h=d.find(".rotate-corner");h.css(b.imager.touchDevice?b.options.controlsTouchCss:b.options.controlsCss);var i=a("body"),j=a(this.imager.canvas).offset();b.centerX=j.left+this.controlsStartWidth/2,b.centerY=j.top+this.controlsStartHeight/2,b.setAngle(b.angle),h.on(e,function(a){b.prevAngle=-1*b.angle;var d=c.getEventPosition(a),e=b.getAngle(b.centerX,b.centerY,d.left,d.top);return i.on(g,function(a){var d=c.getEventPosition(a),f=b.getAngle(b.centerX,b.centerY,d.left,d.top),g=e-f;return b.angle=b.prevAngle+g,b.angle*=-1,b.setAngle(b.angle),a.preventDefault(),a.stopPropagation(),!1}),i.on(f,function(){i.off(f),i.off(g),b.lastAngle=b.angle}),a.preventDefault(),a.stopPropagation(),!1})},h.prototype.stopRotate=function(){this.$rotateControls.remove(),this.$rotateControls=null},h.prototype.setAngle=function(a){this.angle=a,this.$rotateControls.css("-webkit-transform","rotate("+a+"rad)");var b=this.getRotatedDimensions(this.controlsStartWidth,this.controlsStartHeight,a);this.widthDiff=b.width-this.controlsStartWidth,this.heightDiff=b.height-this.controlsStartHeight,this.$rotateControls.css({top:this.heightDiff/2,left:this.widthDiff/2}),this.imager.setPreviewSize(b.width,b.height),this.imager.render()},h.prototype.render=function(a){var b=this.imager.tempCanvas.getContext("2d");b.clearRect(0,0,b.canvas.width,b.canvas.height);var c=this.imager.convertScale(this.widthDiff,this.controlsStartWidth,a.canvas.width),d=this.imager.convertScale(this.heightDiff,this.controlsStartHeight,a.canvas.height);b.canvas.width=a.canvas.width+c,b.canvas.height=a.canvas.height+d,this.rotateCanvas(b,this.angle),b.translate(c/2,d/2),b.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,0,0,a.canvas.width,a.canvas.height),b.translate(-c/2,-d/2),this.restoreCanvasRotation(b,this.angle),a.canvas.width+=c,a.canvas.height+=d,this.imager.clearCanvas(a);var e=0,f=0;this.$rotateControls&&(e=this.imager.convertScale(10,this.controlsStartWidth,a.canvas.width),f=this.imager.convertScale(10,this.controlsStartHeight,a.canvas.height)),a.drawImage(b.canvas,0,0,b.canvas.width,b.canvas.height,e,f,a.canvas.width-2*e,a.canvas.height-2*f)},h.prototype.rotateCanvas=function(a,b){a.translate(a.canvas.width/2,a.canvas.height/2),a.rotate(b),a.translate(-a.canvas.width/2,-a.canvas.height/2)},h.prototype.restoreCanvasRotation=function(a,b){a.translate(a.canvas.width/2,a.canvas.height/2),a.rotate(-1*b),a.translate(-a.canvas.width/2,-a.canvas.height/2)},h.prototype.getRotatedDimensions=function(a,b,c){0>c&&(c*=-1),c>2*Math.PI&&(c-=2*Math.PI,c=2*Math.PI-c),c>Math.PI&&(c-=Math.PI,c=Math.PI-c),c>Math.PI/2&&(c-=Math.PI/2,c=Math.PI/2-c);var d=a*Math.cos(c),e=b*Math.sin(c),f=d+e,g=a*Math.sin(c),h=b*Math.cos(c),i=g+h;return{width:f,height:i}},h.prototype.getAngle=function(a,b,c,d){return Math.atan2(d-b,c-a)},h.prototype.deserialize=function(a){a&&a.angle&&(this.angle=a.angle)},h.prototype.serialize=function(){return{angle:this.angle}},h.prototype.reset=function(){this.widthDiff=0,this.heightDiff=0,this.angle=0},b.Rotate=h}(jQuery,ImagerJs.plugins,ImagerJs.util,ImagerJs.translations),function(a,b,c,d){var e=function(b,c){var d=this;d.imager=b,d.defaultOptions={upload:!1,uploadFunction:null},c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c)};e.prototype.getButtons=function(){var a=this;return[{classes:"btn-save",iconClasses:"fa-save",tooltip:d.t("Save"),enabledHandler:function(){var b=a.imager.options.contentConfig,c=b?b.saveImageData:null;a.options.upload&&(c=a.options.uploadFunction),c?c.call(a.imager,a.imager.$imageElement.attr("data-imager-id"),a.imager.$imageElement.attr("src"),function(b){a.imager.stopEditing(),a.imager.$imageElement.attr("src",b)}):console.error("No uploadFunction function provided in imager.options.contentConfig.saveImageData.")}}]},b.Save=e}(jQuery,ImagerJs.plugins,ImagerJs.util,ImagerJs.translations),function(a,b,c,d){var e=function(b,c){var d=this;d.imager=b,c=c||{};var e={tooltipEnabled:!0,tooltipCss:null};d.imager.touchDevice&&(e.tooltipEnabled=!1),d.options=a.extend(e,c),d.activeButton=null,d.weight=-100};e.prototype.onEditStart=function(){var a=this;a.toolbar=new d(a.options),a.toolbar.getElement().attr("data-sizeable","toolbar-button").attr("data-cssrules","top:($v * -1)");for(var b=a.imager.invokePluginsMethod("getButtons"),c=0;c<b.length;c++)for(var e=b[c].instance,f=b[c].result,g=0;g<f.length;g++){var h=f[g];h.plugin=e;var i=null;i=void 0===h.group?a.toolbar.addButton(h.classes,h.iconClasses,h.tooltip,a.createHandler(h)):a.toolbar.addButtonToGroup(h.classes,h.iconClasses,h.tooltip,h.group,a.createHandler(h)),h.buttonCreatedHandler&&h.buttonCreatedHandler(i)}a.imager.$editContainer.append(a.toolbar.getElement())},e.prototype.onRemove=function(){this.toolbar&&this.toolbar.remove()},e.prototype.onEditStop=function(){this.toolbar&&this.toolbar.remove()},e.prototype.createHandler=function(a){var b=this;return function(){return b.activeButton&&b.activeButton.disabledHandler&&b.activeButton.disabledHandler(),b.toolbar.clearActiveButton(),a.enabledHandler(),a.applyHandler&&a.rejectHandler&&(b.activeButton=a,b.imager.trigger("toolSelected",a),b.toolbar.setActiveButton(a.classes),b.toolbar.getElement().addClass("hidden"),b.createOperationToolbar(a)),!1}},e.prototype.createOperationToolbar=function(a){var b=this;b.operationToolbar=new d(b.options),b.operationToolbar.addButton("btn-accept","fa-check",c.t("Apply"),function(){return a.applyHandler(),b.operationButtonHandler(),b.imager.trigger("toolApply"),!1}),b.operationToolbar.addButton("btn-reject","fa-times",c.t("Reject"),function(){return a.rejectHandler(),b.operationButtonHandler(),b.imager.trigger("toolReject"),!1}),b.imager.$editContainer.append(b.operationToolbar.getElement())},e.prototype.operationButtonHandler=function(){this.activeButton=null,this.removeOperationToolbar(),this.toolbar.getElement().removeClass("hidden"),this.toolbar.clearActiveButton()},e.prototype.removeOperationToolbar=function(){this.operationToolbar.remove(),this.operationToolbar=null},e.prototype.getActiveButton=function(){return this.activeButton},b.Toolbar=e}(jQuery,ImagerJs.plugins,ImagerJs.translations,window.Toolbar),function(a,b,c,d){var e=function(b,c){var d=this;d.imager=b,d.$toolbarButton=null,c=c?c:{},d.options=a.extend(!0,d.defaultOptions,c)};e.prototype.getButtons=function(){var a=this;return[{classes:"btn-undo",iconClasses:"fa-undo",tooltip:d.t("Undo"),buttonCreatedHandler:function(b){a.$toolbarButton=b},enabledHandler:function(b){a.toolbar=b,a.imager.setWaiting(!0),setTimeout(function(){a.imager.historyUndo(),a.imager.setWaiting(!1)},50)}}]},e.prototype.onHistoryChange=function(){this.imager.history.length>1?(this.$toolbarButton.css({"pointer-events":"all"}),this.$toolbarButton.find("a").css("color","#333")):(this.$toolbarButton.css({"pointer-events":"none"}),this.$toolbarButton.find("a").css("color","#C3C3C3"))},b.Undo=e}(jQuery,ImagerJs.plugins,ImagerJs.util,ImagerJs.translations);